<div class="dashboard-container">
  <header class="welcome-section">
    <div>
      <h1 class="welcome-title">Tableau de Bord</h1>
      <p class="welcome-subtitle">Heureux de vous revoir, {{ user()?.name }}</p>
    </div>
    <div class="date-display">
      <i class="fa-regular fa-calendar-check"></i> {{ today | date:'dd MMMM yyyy':'':'fr' }}
    </div>
  </header>

  <div class="stats-grid">
    <div class="stat-card card-purple">
      <div class="stat-icon"><i class="fa-solid fa-file-invoice-dollar"></i></div>
      <div class="stat-content">
        <span class="label">Mes Devis</span>
        <span class="value">{{ quoteCount() }}</span>
      </div>
    </div>
    <div class="stat-card card-orange">
      <div class="stat-icon"><i class="fa-solid fa-box"></i></div>
      <div class="stat-content">
        <span class="label">Commandes</span>
        <span class="value">{{ orderCount() }}</span>
      </div>
    </div>
    <div class="stat-card card-green" (click)="openCart()">
      <div class="stat-icon"><i class="fa-solid fa-cart-shopping"></i></div>
      <div class="stat-content">
        <span class="label">Mon Panier</span>
        <span class="value">{{ cartCount() }}</span>
        <span class="sub">{{ cartTotal() | number:'1.0-0' }} FCFA</span>
      </div>
    </div>
    <div class="stat-card card-blue">
      <div class="stat-icon"><i class="fa-solid fa-heart"></i></div>
      <div class="stat-content">
        <span class="label">Favoris</span>
        <span class="value">{{ favourites().length }}</span>
      </div>
    </div>
  </div>

  <div class="main-card">
    <div class="card-header">
      <h2>Dernières Activités</h2>
      <div class="filter-group">
        <button [class.active]="filterType() === 'all'" (click)="setFilter('all')">Tout</button>
        <button [class.active]="filterType() === 'quote'" (click)="setFilter('quote')">Devis</button>
        <button [class.active]="filterType() === 'order'" (click)="setFilter('order')">Commandes</button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="dashboard-table">
        <thead>
          <tr>
            <th>Type</th>
            <th>Référence</th>
            <th>Projet</th>
            <th>Date & Heure</th>
            <th>Statut</th>
            <th class="text-right">Montant</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (item of paginatedActivities(); track item.id) {
            <tr>
              <td class="type-column">
                <i [class]="item.type === 'quote' ? 'fa-solid fa-file-lines type-icon quote' : 'fa-solid fa-box type-icon order'"></i>
              </td>
              <td><span class="ref-badge">{{ item.id }}</span></td>
              <td>
                <span class="project-name">{{ item.name }}</span>
              </td>
              <td>
                <div class="date-container">
                  <span class="date-text">{{ item.date | date:'dd/MM/yyyy' }}</span>
                  <span class="time-text">{{ item.date | date:'HH:mm' }}</span>
                </div>
              </td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(item.status)">
                  {{ translateStatus(item.status) }}
                </span>
              </td>
              <td class="text-right">
                <strong class="amount-text">{{ item.amount | number:'1.0-0' }} FCFA</strong>
              </td>
              <td class="text-center">
                <div class="action-menu-container">
                  <button class="btn-dots" (click)="toggleMenu(item.id, $event)">
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                  </button>
                  
                  @if (activeMenuId() === item.id) {
                    <div class="dropdown-menu">
                      <a [routerLink]="item.type === 'quote' ? ['/client/quotes', item.rawId] : ['/client/orders', item.rawId]">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i>
                        <span>Consulter le dossier</span>
                      </a>
                    </div>
                  }
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="7" class="empty-state-container">
                <div class="empty-state-content">
                  <div class="empty-folder-icon">
                    <i class="fa-solid fa-folder-open"></i>
                  </div>
                  <p>Aucune activité récente trouvée.</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if (totalPages() > 1) {
      <div class="pagination-bar">
        <button class="btn-nav" [disabled]="currentPage() === 1" (click)="goToPage(currentPage() - 1)">
          <i class="fa-solid fa-arrow-left"></i> Précédent
        </button>

        <div class="page-numbers">
          @for (p of pagesArray(); track p) {
            <button class="page-num" [class.active]="p === currentPage()" (click)="goToPage(p)">
              {{ p }}
            </button>
          }
        </div>

        <button class="btn-nav" [disabled]="currentPage() === totalPages()" (click)="goToPage(currentPage() + 1)">
          Suivant <i class="fa-solid fa-arrow-right"></i>
        </button>
      </div>
    }
  </div>
</div>