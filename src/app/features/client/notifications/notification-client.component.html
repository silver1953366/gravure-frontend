<div class="notification-container">
  <header class="page-header">
    <div class="header-text">
      <h1>Centre de notifications</h1>
      <p class="subtitle">Suivez l'état de vos devis et de vos commandes en temps réel.</p>
    </div>
    
    <div class="header-actions">
      @if (unreadCount() > 0) {
        <button class="btn-text-action" (click)="markAllAsRead()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 7 17l-5-5"/><path d="m22 10-7.5 7.5L13 16"/></svg>
          Tout marquer comme lu
        </button>
      }
      <span [class]="unreadCount() > 0 ? 'badge-active' : 'badge-muted'">
        {{ unreadCount() }} nouvelle{{ unreadCount() > 1 ? 's' : '' }}
      </span>
    </div>
  </header>

  @if (isLoading()) {
    <div class="loading-skeleton">
      @for (i of [1,2,3]; track i) {
        <div class="skeleton-card"></div>
      }
    </div>
  } 

  @else if (error()) {
    <div class="error-state">
      <div class="error-icon">!</div>
      <p>{{ error() }}</p>
      <button class="btn-retry" (click)="loadNotifications()">Réessayer</button>
    </div>
  }

  @else {
    <div class="notification-feed">
      @for (notif of notifications(); track notif.id) {
        <article 
          class="notification-card" 
          [class.unread]="!notif.is_read"
          [attr.data-type]="notif.type"
          (click)="markAsRead(notif)">
          
          <div class="icon-wrapper">
            @switch (notif.type) {
              @case ('success') {
                <svg class="icon success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17L4 12"></path></svg>
              }
              @case ('warning') {
                <svg class="icon warning" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
              }
              @case ('error') {
                <svg class="icon error" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
              }
              @default {
                <svg class="icon info" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
              }
            }
          </div>

          <div class="card-content">
            <div class="card-header">
              <h3 class="notif-title">{{ notif.title }}</h3>
              <time class="notif-date">{{ notif.created_at | date:'HH:mm' }} • {{ notif.created_at | date:'dd MMM yyyy' }}</time>
            </div>
            
            <p class="notif-message">{{ notif.message }}</p>

            @if (notif.link) {
              <a [routerLink]="notif.link" class="notif-action" (click)="$event.stopPropagation()">
                Consulter les détails
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </a>
            }
          </div>

          <div class="card-menu">
            <button class="btn-delete" (click)="deleteNotification($event, notif.id)" title="Supprimer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            </button>
          </div>
        </article>
      } @empty {
        <div class="empty-state">
          <div class="empty-illustration">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="1.5"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
          </div>
          <h3>Aucune notification</h3>
          <p>Vous êtes parfaitement à jour. Toutes vos activités récentes ont été traitées.</p>
          <button routerLink="/client/quotes" class="btn-primary">Nouveau devis</button>
        </div>
      }
    </div>
  }
</div>