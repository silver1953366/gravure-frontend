<div class="max-w-xl mx-auto p-6 bg-white border border-gray-200 rounded-xl shadow-xl">
    <h2 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-2">
        Finalisation de la Commande
    </h2>

    <div class="mb-5 p-4 bg-indigo-50 border-l-4 border-indigo-500 text-indigo-800">
        <p class="font-semibold text-lg">Montant total à payer :</p>
        <p class="text-3xl font-bold">{{ confirmedQuote().final_price_fcfa | number:'1.0-0' }} FCFA</p>
        <p class="mt-2 text-sm">Basé sur le devis #{{ confirmedQuote().id }}</p>
    </div>

    @if (submissionMessage()) {
        <div class="mb-4 p-3 rounded-lg"
           [ngClass]="{
               'bg-green-100 text-green-700 border border-green-300': submissionStatus() === 'success',
               'bg-red-100 text-red-700 border border-red-300': submissionStatus() === 'error'
           }">
            {{ submissionMessage() }}
        </div>
    }

    <form [formGroup]="addressForm" (ngSubmit)="onSubmit()">
        <fieldset class="border border-gray-300 p-4 rounded-lg mb-6">
            <legend class="text-lg font-semibold text-gray-700 px-2">Adresse de Livraison</legend>
            
            <div class="mb-4">
                <label for="street" class="block text-sm font-medium text-gray-700">Rue / Quartier <span class="text-red-500">*</span></label>
                <input id="street" type="text" formControlName="street" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                @if (addressForm.get('street')?.invalid && addressForm.get('street')?.touched) {
                    <div class="text-red-500 text-xs mt-1">La rue/quartier est obligatoire.</div>
                }
            </div>

            <div class="mb-4">
                <label for="city" class="block text-sm font-medium text-gray-700">Ville <span class="text-red-500">*</span></label>
                <input id="city" type="text" formControlName="city" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                @if (addressForm.get('city')?.invalid && addressForm.get('city')?.touched) {
                    <div class="text-red-500 text-xs mt-1">La ville est obligatoire.</div>
                }
            </div>

            <div class="mb-4">
                <label for="postal_code" class="block text-sm font-medium text-gray-700">Code Postal <span class="text-red-500">*</span></label>
                <input id="postal_code" type="text" formControlName="postal_code" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                @if (addressForm.get('postal_code')?.invalid && addressForm.get('postal_code')?.touched) {
                    <div class="text-red-500 text-xs mt-1">Le code postal est obligatoire.</div>
                }
            </div>
        </fieldset>

        <button type="submit" 
                [disabled]="addressForm.invalid || submissionStatus() === 'loading' || submissionStatus() === 'success'" 
                class="w-full py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition duration-150 ease-in-out">
            @if (submissionStatus() === 'loading') {
                <span>Création de la Commande...</span>
            } @else if (submissionStatus() === 'success') {
                <span>Commande #{{ createdOrder()?.reference }} Créée!</span>
            } @else {
                <span>Confirmer et Procéder au Paiement</span>
            }
        </button>
    </form>
</div>