<div class="dashboard-container">
  
  <header class="page-header">
    <div class="header-main">
      <h1>Mes Devis</h1>
      <p class="subtitle">Historique et suivi de vos demandes</p>
    </div>
    <a routerLink="/client/quotes/create" class="btn-primary">
      <i class="fa-solid fa-plus"></i> Nouveau Projet
    </a>
  </header>

  <div class="toolbar">
    <div class="search-bar">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input 
        #searchInput
        type="text" 
        placeholder="Rechercher par matériau (ex: Acier, Bois...)" 
        (input)="searchQuery.set(searchInput.value)">
    </div>
    
    <div class="filter-group">
      <select (change)="onSortChange($event)" class="sort-select">
        <option value="recent">Plus récents</option>
        <option value="oldest">Plus anciens</option>
      </select>
    </div>
  </div>

  @if (isLoading()) {
    <div class="loader-container">
      <div class="spinner"></div>
      <p>Chargement de vos projets...</p>
    </div>
  } @else if (errorOccurred()) {
    <div class="state-card error">
      <i class="fa-solid fa-circle-exclamation"></i>
      <p>Impossible de charger les données.</p>
      <button (click)="fetchQuotes(currentSort())" class="btn-retry">Réessayer</button>
    </div>
  } @else {
    @if (filteredQuotes(); as list) {
      <div class="quotes-stack">
        @for (quote of list; track quote.id) {
          <div class="quote-item">
            <div class="status-line" [ngClass]="getStatusClass(quote.status)"></div>
            
            <div class="quote-content">
              <div class="info-main">
                <span class="ref">#{{ quote.reference }}</span>
                <span class="date">{{ quote.created_at | date: 'dd/MM/yyyy' : '' : 'fr' }}</span>
              </div>

              <div class="specs-row">
                <div class="spec">
                  <small>Matériau</small>
                  <strong>{{ quote.material?.name || 'N/A' }}</strong>
                </div>
                <div class="spec">
                  <small>Quantité</small>
                  <strong>{{ quote.quantity }} pce(s)</strong>
                </div>
              </div>
            </div>

            <div class="quote-actions">
              <div class="price-box">
                <span class="amount">{{ quote.final_price_fcfa | number:'1.0-0' }}</span>
                <span class="currency">FCFA</span>
              </div>
              <div class="badge-wrapper">
                <span class="status-badge" [ngClass]="getStatusClass(quote.status)">
                  {{ STATUS_LABELS[quote.status] }}
                </span>
              </div>
              <a [routerLink]="['/client/quotes', quote.id]" class="btn-icon">
                <i class="fa-solid fa-chevron-right"></i>
              </a>
            </div>
          </div>
        } @empty {
          <div class="state-card empty">
            <i class="fa-solid fa-box-open"></i>
            <p>Aucun devis trouvé pour ce matériau.</p>
          </div>
        }
      </div>
    }
  }
</div>